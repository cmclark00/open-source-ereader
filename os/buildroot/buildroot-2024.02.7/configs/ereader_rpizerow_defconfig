# E-Reader Buildroot configuration for Raspberry Pi Zero W
# Based on ereader_rpi4_64_defconfig but adapted for Pi Zero W hardware

# Target Architecture - ARM (32-bit) for BCM2835
BR2_arm=y
BR2_arm1176jzf_s=y
BR2_ARM_EABIHF=y

# Use musl C library for smaller footprint
BR2_TOOLCHAIN_BUILDROOT_MUSL=y
# Linux headers same as kernel, 6.1 series
BR2_PACKAGE_HOST_LINUX_HEADERS_CUSTOM_6_1=y
# Enable C++ support (needed for some packages)
BR2_TOOLCHAIN_BUILDROOT_CXX=y

# System Configuration
BR2_TARGET_GENERIC_HOSTNAME="ereader"
BR2_TARGET_GENERIC_ISSUE="Welcome to E-Reader OS"
BR2_TARGET_GENERIC_GETTY_OPTIONS="-a root"
BR2_SYSTEM_DHCP="wlan0"

# Filesystem overlay and scripts
BR2_ROOTFS_OVERLAY="board/raspberrypi/ereader-overlay"
BR2_ROOTFS_POST_BUILD_SCRIPT="board/raspberrypi0w/post-build.sh"
BR2_ROOTFS_POST_IMAGE_SCRIPT="board/raspberrypi0w/post-image.sh"

# Linux Kernel
BR2_LINUX_KERNEL=y
BR2_LINUX_KERNEL_CUSTOM_TARBALL=y
BR2_LINUX_KERNEL_CUSTOM_TARBALL_LOCATION="$(call github,raspberrypi,linux,17f135b742c4edb340afb365873c3a574f7e16cb)/linux-17f135b742c4edb340afb365873c3a574f7e16cb.tar.gz"
BR2_LINUX_KERNEL_DEFCONFIG="bcmrpi"
BR2_LINUX_KERNEL_CONFIG_FRAGMENT_FILES="board/raspberrypi/ereader-kernel.fragment"
BR2_LINUX_KERNEL_DTS_SUPPORT=y
BR2_LINUX_KERNEL_INTREE_DTS_NAME="bcm2708-rpi-zero-w"
BR2_LINUX_KERNEL_NEEDS_HOST_OPENSSL=y

# BusyBox
BR2_PACKAGE_BUSYBOX_SHOW_OTHERS=y

# Compression tools
BR2_PACKAGE_XZ=y

# Raspberry Pi Firmware
BR2_PACKAGE_RPI_FIRMWARE=y
BR2_PACKAGE_RPI_FIRMWARE_BOOTCODE_BIN=y
BR2_PACKAGE_RPI_FIRMWARE_VARIANT_PI=y
BR2_PACKAGE_RPI_FIRMWARE_CONFIG_FILE="board/raspberrypi/config_ereader_zerow.txt"

# Python 3 (for reader application)
BR2_PACKAGE_PYTHON3=y

# Device Tree Compiler
BR2_PACKAGE_DTC=y
BR2_PACKAGE_DTC_PROGRAMS=y

# Linux Firmware (for WiFi)
BR2_PACKAGE_LINUX_FIRMWARE=y
BR2_PACKAGE_LINUX_FIRMWARE_BRCM_BCM43XXX=y

# Network Packages
BR2_PACKAGE_DHCPCD=y
BR2_PACKAGE_DROPBEAR=y
BR2_PACKAGE_IW=y
BR2_PACKAGE_OPENSSH=y
BR2_PACKAGE_WIRELESS_TOOLS=y
BR2_PACKAGE_WPA_SUPPLICANT=y
BR2_PACKAGE_WPA_SUPPLICANT_CLI=y
BR2_PACKAGE_WPA_SUPPLICANT_WPA_CLIENT_SO=y
BR2_PACKAGE_WPA_SUPPLICANT_PASSPHRASE=y

# Kernel Module Tools
BR2_PACKAGE_KMOD=y
BR2_PACKAGE_KMOD_TOOLS=y

# Filesystem Settings
BR2_TARGET_ROOTFS_EXT2=y
BR2_TARGET_ROOTFS_EXT2_4=y
BR2_TARGET_ROOTFS_EXT2_SIZE="120M"
# BR2_TARGET_ROOTFS_TAR is not set

# Host Tools (for SD card image creation)
BR2_PACKAGE_HOST_DOSFSTOOLS=y
BR2_PACKAGE_HOST_GENIMAGE=y
BR2_PACKAGE_HOST_KMOD_XZ=y
BR2_PACKAGE_HOST_MTOOLS=y
