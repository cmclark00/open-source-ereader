# Architecture and CPU settings for Raspberry Pi Zero W
BR2_arm=y
BR2_arm1176jzf_s=y
BR2_ARM_EABIHF=y

# Linux kernel version - 6.1 LTS series for stability
BR2_PACKAGE_HOST_LINUX_HEADERS_CUSTOM_6_1=y

# Enable C++ toolchain support for future features
BR2_TOOLCHAIN_BUILDROOT_CXX=y

# Linux kernel configuration
BR2_LINUX_KERNEL=y
BR2_LINUX_KERNEL_CUSTOM_TARBALL=y
BR2_LINUX_KERNEL_CUSTOM_TARBALL_LOCATION="$(call github,raspberrypi,linux,17f135b742c4edb340afb365873c3a574f7e16cb)/linux-17f135b742c4edb340afb365873c3a574f7e16cb.tar.gz"
BR2_LINUX_KERNEL_DEFCONFIG="bcmrpi"
BR2_LINUX_KERNEL_DTS_SUPPORT=y
BR2_LINUX_KERNEL_INTREE_DTS_NAME="bcm2708-rpi-zero-w"
BR2_LINUX_KERNEL_NEEDS_HOST_OPENSSL=y

# Enable kernel headers for building modules
BR2_KERNEL_HEADERS_AS_KERNEL=y

# Apply custom kernel configuration fragment for SPI, GPIO, and framebuffer support
BR2_LINUX_KERNEL_CONFIG_FRAGMENT_FILES="configs/linux_ereader.fragment"

# Raspberry Pi firmware
BR2_PACKAGE_RPI_FIRMWARE=y
BR2_PACKAGE_RPI_FIRMWARE_BOOTCODE_BIN=y
BR2_PACKAGE_RPI_FIRMWARE_VARIANT_PI=y
BR2_PACKAGE_RPI_FIRMWARE_CONFIG_FILE="board/ereader/config_ereader.txt"

# System configuration
BR2_TARGET_GENERIC_HOSTNAME="ereader"
BR2_TARGET_GENERIC_ISSUE="Welcome to E-Reader"
BR2_ROOTFS_DEVICE_CREATION_DYNAMIC_EUDEV=y

# Root filesystem overlay - adds sample books and init scripts
BR2_ROOTFS_OVERLAY="board/ereader/rootfs-overlay"

# Root password for development (change in production!)
BR2_TARGET_GENERIC_ROOT_PASSWD="ereader"

# Enable getty on serial console for debugging
BR2_TARGET_GENERIC_GETTY=y
BR2_TARGET_GENERIC_GETTY_PORT="ttyAMA0"
BR2_TARGET_GENERIC_GETTY_BAUDRATE_115200=y

# Filesystem configuration - ext4 for reliability
BR2_TARGET_ROOTFS_EXT2=y
BR2_TARGET_ROOTFS_EXT2_4=y
BR2_TARGET_ROOTFS_EXT2_SIZE="256M"

# Disable TAR filesystem to save space
# BR2_TARGET_ROOTFS_TAR is not set

# Required host tools to create the SD image
BR2_PACKAGE_HOST_DOSFSTOOLS=y
BR2_PACKAGE_HOST_GENIMAGE=y
BR2_PACKAGE_HOST_MTOOLS=y

# Enable compressed kernel module support
BR2_PACKAGE_BUSYBOX_SHOW_OTHERS=y
BR2_PACKAGE_KMOD_TOOLS=y
BR2_PACKAGE_XZ=y
BR2_PACKAGE_KMOD=y
BR2_PACKAGE_HOST_KMOD_XZ=y

# Development and debugging utilities
BR2_PACKAGE_STRACE=y
BR2_PACKAGE_LTRACE=y
BR2_PACKAGE_GDB=y
BR2_PACKAGE_GDB_SERVER=y

# E-Reader custom packages
BR2_PACKAGE_DISPLAY_TEST=y
BR2_PACKAGE_BUTTON_TEST=y
BR2_PACKAGE_EREADER=y

# Post-build and post-image scripts
BR2_ROOTFS_POST_BUILD_SCRIPT="board/ereader/post-build.sh"
BR2_ROOTFS_POST_IMAGE_SCRIPT="board/ereader/post-image.sh"
BR2_ROOTFS_POST_SCRIPT_ARGS="--genimage-config board/ereader/genimage.cfg"
